---
layout: post
title: AWS Redshift 데이터 적재 모범사례(COPY)
date: 2021-05-07 16:57:00
description: COPY 명령 빠르게 사용
---

참고
* 데이터 로드: <a href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c_loading-data-best-practices.html " target="blank">https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c_loading-data-best-practices.html</a>

* 자습서: <a href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-loading-data.html " target="blank">https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-loading-data.html</a>

<br>
<br>

### 단계 5: COPY 명령 실행
<br>

### REGION

가능하다면 항상 Amazon Redshift 클러스터와 동일한 AWS 리전에 로드 데이터를 위치시켜야 합니다. 데이터와 클러스터가 동일한 리전에 있는 경우 지연 시간이 줄어들고 리전 간 데이터 전송 비용을 피할 수 있습니다. 
<br>
-> Redshift 와 S3의 리전을 동일하게 맞춰줘야 서로 간 COPY 명령으로 이동시 이득을 볼 수 있음
<br>
<br>

리전이 다를 경우 확인 필요
<br>

-> 다른 AWS 리전에서 데이터를 로드해야 하는 경우, REGION 옵션을 사용하여 로드 데이터가 위치한 AWS 리전을 지정합니다. 리전을 지정하는 경우, 매니페스트 파일을 포함한 모든 로드 데이터가 명명된 리전에 있어야 합니다. 

* 예시 COPY문

{% highlight sql %}

copy supplier from 's3://<버켓 이름>/load/supplier.tbl' 
iam role 'aws ~~' 
delimiter '|' 
gzip
region 'us-east-1';

{% endhighlight %}

<br>
<br>

### 여러 파일에서 병렬로 로드
<br>
병렬로 로드할 때 데이터 효과적으로 로드.
<br>
파일 수가 클러스터에 있는 조각 수의 배수가 되도록 데이터 분할
<br>
<br>
예: dc2.large 노드는 각각 조각이 2개. 4노드 클러스터는 8개의 조각 가짐. -> 파일을 8개로 쪼개서 병렬로 로드하면 더 빠르게 로드 가능. 반면 1개 단일 파일로 로드하면 시간 오래 걸림
<br>
<br>

* 1개 단일 파일 COPY 로드시 시간 1m 42s

* 1개 파일 8개로 쪼개서 병렬 COPY 로드시 시간 17s
